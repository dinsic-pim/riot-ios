name: Tchap

schemes:
  Tchap:
    analyze:
      config: Debug
    archive:
      config: Release
    build:
      targets:
        Tchap:
        - running
        - testing
        - profiling
        - analyzing
        - archiving
    profile:
      config: Release
    run:
      config: Debug
      disableMainThreadChecker: true
    test:
      config: Debug
      disableMainThreadChecker: true
      targets:
      - TchapTests

targets:
  Tchap:
    type: application
    platform: iOS

    dependencies:
    - target: TchapShareExtension
    - target: SiriIntents
    - target: TchapNSE
    - target: DesignKit

    configFiles:
      Debug: SupportingFiles/App-Debug.xcconfig
      Release: SupportingFiles/App-Release.xcconfig

    preBuildScripts:
    - name: ‚ö†Ô∏è SwiftLint
      runOnlyWhenInstalling: false
      shell: /bin/sh
      script: "\"${PODS_ROOT}/SwiftLint/swiftlint\"\n"
    - name: üõ† SwiftGen
      runOnlyWhenInstalling: false
      shell: /bin/sh
      script: "\"${PODS_ROOT}/SwiftGen/bin/swiftgen\" config run --config \"Tools/SwiftGen/swiftgen-config.yml\"\n"

    settings:
      base:
        GCC_PREPROCESSOR_DEFINITIONS: $(inherited) ENABLE_JOIN_BY_LINK=1 ENABLE_ROOM_RETENTION=1
        OTHER_SWIFT_FLAGS: $(inherited) -D ENABLE_ROOM_RETENTION

    sources:
    - path: ../Tools
      excludes:
        - "Logs"
        - "Release"
        - "Templates/*.sh"
    - path: ../Tchap/Config
    - path: .
      excludes:
        - "Modules/Room/EmojiPicker/Data/EmojiMart/EmojiJSONStore.swift"
        - "**/*.strings" # Exclude all strings files

    # Add separately localizable files
    - path: Assets/Localizations/fr.lproj/Tchap.strings
    - path: Assets/Localizations/fr.lproj/Tchap.stringsdict
    
    # Riot
    - path: ../Riot/Modules/Common/SegmentedViewController/SegmentedViewController.m
    - path: ../Riot/Categories/Bundle.swift
    - path: ../Riot/Categories/Character.swift
    - path: ../Riot/Categories/MXRoom+Riot.m
    - path: ../Riot/Categories/UIColor.swift
    - path: ../Riot/Categories/UISearchBar.swift
    - path: ../Riot/Categories/UIView.swift
    - path: ../Riot/Categories/String.swift
    - path: ../Riot/Categories/MXRoomSummary+Riot.m
    - path: ../Riot/Managers/EncryptionKeyManager/EncryptionKeyManager.swift
    - path: ../Riot/Managers/KeyValueStorage
    - path: ../Riot/Managers/Settings/RiotSettings.swift
    - path: ../Riot/Managers/Theme/
    - path: ../Riot/Modules/Common/Recents/CellData/RecentCellData.m
    - path: ../Riot/Utils/AvatarGenerator.m
    - path: ../Riot/Utils/UserNameColorGenerator.swift
    
    # Resources
    - path: ../Riot/Modules/Common/SegmentedViewController/SegmentedViewController.xib
      buildPhase: resources
